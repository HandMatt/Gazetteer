function removeLoad(){0==$("#preloader:hidden").length&&$("#preloader").attr("style","display: none !important")}function getPosition(){return new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t)})}function getLocation(){getPosition().then(e=>{formData.lat=e.coords.latitude,formData.lng=e.coords.longitude,formData.geoLocate=!0,L.marker([formData.lat,formData.lng],{icon:userIcon}).addTo(map).bindPopup("Your location"),getCountryCode(formData),setNull(formData)}).catch(e=>{console.error(e.message),removeLoad()})}function getCountryCode(e){$("#preloader").attr("style","display: show !important"),$.ajax({url:"php/getCountryCode.php",type:"GET",dataType:"json",data:e,error:(e,t,o)=>{console.log(e.responseText),console.log(o),removeLoad()},success:t=>{"ok"==t.status.name&&(countryCode=t.countryCode,"status"in countryCode?(e.lat=t.latitude,e.lng=t.longitude,getOceanData(e)):(e.iso_a2=countryCode.countryCode,e.country=countryCode.countryName,e.geoLocate=t.geoLocate,getCountryData(e)))}})}function getOceanData(e){$.ajax({url:"php/getOcean.php",type:"GET",dataType:"json",data:e,error:(e,t,o)=>{console.log(e.responseText),console.log(o),removeLoad()},success:t=>{"ok"==t.status.name&&(removeLoad(),L.marker([e.lat,e.lng],{icon:oceanIcon}).addTo(map).bindPopup(`<a href=https://${t.geonameId.wikipediaURL} target="_blank">${t.ocean.ocean.name}</a>`).openPopup())}})}function getCountryData(e){$("#preloader").attr("style","display: flex !important"),$.ajax({url:"php/getCountry.php",type:"GET",dataType:"json",data:e,error:(e,t,o)=>{console.log(e.responseText),console.log(o),removeLoad()},success:e=>{if("ok"==e.status.name){document.getElementById("country-dropdown").value=e.countryCode,createGeoJson(e.geoJson);const o=e.countryInfo.geonames[0];$(".country-name").html(`${o.countryName}, ${e.countryCode}`),$("#capital").html(o.capital),$("#population").html(numberWithCommas(o.population)),$("#area").html(numberWithCommas(o.areaInSqKm));const n=e.geonamesWiki.geonames.filter(e=>e.title.includes(o.countryName)||"country"==e.feature)[0];$("#countrySummary").html(n.summary),$("#wikiLink").attr("href","https://"+n.wikipediaUrl);const a=e.restCountries;$(".flag").attr({src:a.flag,alt:`The national flag of ${a.name}`}),$("#region").html(a.region),$("#subregion").html(a.subregion),$("#language").html(a.languages[0].name);const r=a.currencies[0];$("#currencyName").html(r.name),$("#currencySymbol").html(`(${r.symbol})`);var t=e.openWeather.daily;for(let e=0;e<4;e++)tempMax=kelvinToCelsius(t[e].temp.max),tempMin=kelvinToCelsius(t[e].temp.min),windSpeed=t[e].wind_speed,windDirection=t[e].wind_deg,weatherIcon=t[e].weather[0].icon,weatherDescription=t[e].weather[0].description,$("#day"+(e+1)).children().eq(1).children().eq(0).attr("src",`https://openweathermap.org/img/wn/${weatherIcon}@2x.png`),$("#day"+(e+1)).children().eq(1).children().eq(1).html(`<div class="d-flex justify-content-between">\n              <h3 class="fs-6 m-0">High:</h3><span>${String(tempMax)+"℃"}</span>\n            </div>\n            <div class="d-flex justify-content-between">\n              <h3 class="fs-6 m-0">Low:</h3><span>${String(tempMin)+"℃"}</span>\n            </div>\n\t\t\t\t\t\t<div class="d-flex justify-content-between">\n              <h3 class="fs-6 m-0">Wind:</h3><span>${windSpeed}m/s, <i class="fas fa-arrow-up" style="-webkit-transform:rotate(${windDirection}deg); transform:rotate(${windDirection}deg);"></i></i></span>\n            </div>\n\t\t\t\t\t\t<div class="d-flex justify-content-between">\n              <h3 class="fs-6 m-0">Weather:</h3><span>${weatherDescription}</span>\n            </div>`);if(!e.geonamesCities.status){const t=e.geonamesCities.geonames.filter(t=>t.countrycode.includes(e.countryCode));let o=t.length;o>10&&(o=10);for(let e=0;e<o;e++)"PPLC"==t[e].fcode?L.marker([t[e].lat,t[e].lng],{icon:capitalIcon}).addTo(map).bindPopup(`<h5><a href=https://${t[e].wikipedia} target="_blank">${t[e].name}</a> - Capital</h3>\n\t\t\t\t\t\t\t\t<strong>Population:</strong> ${t[e].population}`):L.marker([t[e].lat,t[e].lng],{icon:cityIcon}).addTo(map).bindPopup(`<h5><a href=https://${t[e].wikipedia} target="_blank">${t[e].name}</a></h3>\n\t\t\t\t\t\t\t\t<strong>Population:</strong> ${t[e].population}`)}void 0!==r?e.geoLocate?$("#fromCurrency").val(r.code):($("#toCurrency").val(r.code),$("#exchangeResult").html("")):currencyDropdown.prop("selectedIndex",0),removeLoad(),showData()}}})}function createGeoJson(e){geoJsonLayer&&map.removeLayer(geoJsonLayer),geoJsonLayer=L.geoJson(e,{style:geoJsonStyle}).addTo(map),map.fitBounds(geoJsonLayer.getBounds())}function showData(){const e=document.getElementById("offcanvasBottom"),t=new bootstrap.Offcanvas(e);t.show()}function setNull(e){Object.keys(e).forEach(function(t){e[t]=null})}function numberWithCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function addDays(e,t){const o=new Date(Number(e));o.setDate(e.getDate()+t);let n=o.toDateString().slice(0,3);return n}function kelvinToCelsius(e){return Math.round(e-273.15)}function getCurrencyExchange(){exchangeAmount=parseFloat($("#exchangeAmount").val()),fromCurrency=$("#fromCurrency option:selected").val(),toCurrency=$("#toCurrency option:selected").val(),exchangeAmount&&"Choose Currency"!==fromCurrency&&"Choose Currency"!==toCurrency?$.ajax({url:"php/getExchange.php",type:"GET",dataType:"json",error:(e,t,o)=>{console.log(e.responseText),console.log(o)},success:e=>{fromRate=e.exchangeRates[fromCurrency],amountUSD=exchangeAmount/fromRate,toRate=e.exchangeRates[toCurrency],exchanged=Number.parseFloat(amountUSD*toRate).toFixed(2),$.getJSON("json/currencies.json",function(e){currency=e.find(e=>e.cc===toCurrency),$("#toCurrencySymbol").html(currency.symbol)}),$("#exchangeResultH").html("Result:"),$("#exchangeResult").html(`<span id="toCurrencySymbol"></span>\n\t\t\t\t<span class="ms-2" id="exchangeRecieved"></span>${numberWithCommas(exchanged)}`)}}):($("#exchangeResultH").html("Result:"),$("#exchangeResult").html("Form incomplete"))}var map=L.map("map");map.createPane("labels"),map.setView([0,0],2),map.getPane("labels").style.zIndex=650,map.getPane("labels").style.pointerEvents="none",L.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.{ext}",{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:1,maxZoom:16,ext:"jpg"}).addTo(map),L.tileLayer("https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png",{attribution:"©OpenStreetMap, ©CartoDB",pane:"labels"}).addTo(map);var MapIcon=L.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,40],popupAnchor:[0,-42]}}),userIcon=new MapIcon({iconUrl:"images/userMarker.png"}),capitalIcon=new MapIcon({iconUrl:"images/capitalMarker.png"}),cityIcon=new MapIcon({iconUrl:"images/cityMarker.png"}),oceanIcon=new MapIcon({iconUrl:"images/oceanMarker.png"});const geoJsonStyle={color:"#85e384",opacity:.8,weight:2};let geoJsonLayer=[];$.ajax({url:"php/getCountryList.php",type:"GET",dataType:"JSON",error:(e,t,o)=>{console.warn(e.responseText),console.log(o)},success:e=>{const t=$("#country-dropdown");t.empty(),t.append('<option selected="true" disabled>Choose a Country</option>'),t.prop("selectedIndex",0),e.data.forEach(e=>{t.append(`<option value=${e.code}>${e.name}</option>`)})}});const currencyDropdown=$(".currency-dropdown");currencyDropdown.empty(),currencyDropdown.append('<option selected="true" disabled>Choose Currency</option>'),currencyDropdown.prop("selectedIndex",0),$.getJSON("json/currencies.json",function(e){e.forEach(e=>{currencyDropdown.append(`<option value=${e.cc}>${e.name} (${e.symbol})</option>`)})});var date=new Date;$("#thirdDay").html(addDays(date,2)),$("#fourthDay").html(addDays(date,3));var formData={iso_a2:null,country:null,lat:null,lng:null,geoLocate:null};$("#allowGeoLoc").on("click",()=>{$("#landingPage").attr("style","display: none !important"),getLocation()}),$("#locateMe").on("click",()=>{$("#landingPage").attr("style","display: show !important")}),$("#denyGeoLoc").on("click",()=>{$("#landingPage").attr("style","display: none !important"),removeLoad()}),map.on("click",function(e){formData.lat=e.latlng.lat,formData.lng=e.latlng.lng,formData.geoLocate=null,getCountryCode(formData),setNull(formData)}),$("#country-dropdown").on("change",()=>{formData.country=$("#country-dropdown option:selected").text(),formData.iso_a2=$("#country-dropdown").val(),formData.geoLocate=null,getCountryData(formData),setNull(formData)}),$("#convertBtn").on("click",()=>{getCurrencyExchange()}),$("#currencySwap").on("click",()=>{$(".fa-exchange-alt").addClass("imageRot").one("webkitAnimationEnd mozAnimationEnd oAnimationEnd msAnimationEnd animationend",function(){$(this).removeClass("imageRot");let e=$("#fromCurrency option:selected").val(),t=$("#toCurrency option:selected").val();document.getElementById("toCurrency").value=e,document.getElementById("fromCurrency").value=t})});